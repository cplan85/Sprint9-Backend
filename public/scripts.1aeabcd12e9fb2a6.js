!function(f,u){"function"==typeof define&&define.amd?define(["MapboxglSpiderfier"],u):"object"==typeof exports?module.exports=u(require("mapbox-gl")):f.MapboxglSpiderfier=u(f.mapboxgl)}(this,function(f){return function(L,m){var s={each:x,map:function P(e,r){var n=[];return x(e,function(t,a){n.push(r(t,a))}),n},mapTimes:function C(e,r){var n=[];return M(e,function(t){n.push(r(t))}),n},eachTimes:M},v=function(){},l={circleSpiralSwitchover:9,circleFootSeparation:25,spiralFootSeparation:28,spiralLengthStart:15,spiralLengthFactor:4,onClick:m.onClick||v,initializeMarker:m.initializeMarker||v,animate:m.animate||!1,animationSpeed:m.animationSpeed||(m.animationSpeed?200:0)},g=2*Math.PI,p=[];function S(){s.each(p.reverse(),function(e,r){l.animate&&(e.elements.parent.style.transitionDelay=l.animationSpeed/1e3/p.length*r+"s",e.elements.parent.className+=" exit"),setTimeout(function(){e.mapboxMarker.remove()},l.animationSpeed+100)}),p=[]}function x(e,r){var n=0;if(!e||!e.length)return[];for(n=0;n<e.length;n++)r(e[n],n)}function M(e,r){if(!e)return[];for(i=0;i<e;i++)r(i)}this.spiderfy=function y(e,r){var t,n=function F(e){return e>=l.circleSpiralSwitchover?function T(e,r){var n=l.spiralLengthStart,t=0;return s.mapTimes(e,function(a){var o;return t+=l.spiralFootSeparation/n+5e-4*a,o={x:n*Math.cos(t),y:n*Math.sin(t),angle:t,legLength:n,index:a},n+=g*l.spiralLengthFactor/t,o})}(e):function b(e,r){var t=l.circleFootSeparation*(2+e)/g,a=g/e;return s.mapTimes(e,function(o){var c=o*a;return{x:t*Math.cos(c),y:t*Math.sin(c),angle:c,legLength:t,index:o}})}(e)}(r.length);S(),t=s.map(r,function(a,o){var k,h,c=n[o],d=function N(e,r){var n=document.createElement("div"),t=document.createElement("div"),a=document.createElement("div");return n.className="spidered-marker"+(l.animate?" animate initial ":" "),a.className="line-div",t.className="icon-div",n.appendChild(a),n.appendChild(t),n.style["margin-left"]=e.x+"px",n.style["margin-top"]=e.y+"px",a.style.height=e.legLength+"px",a.style.transform="rotate("+(e.angle-Math.PI/2)+"rad)",{parent:n,line:a,marker:t}}(c);return k=new f.Marker(d.parent).setLngLat(e),l.initializeMarker(h={marker:a,elements:d,mapboxMarker:k,spiderParam:c}),d.parent.onclick=function(E){l.onClick(E,h)},h}),s.each(t.reverse(),function(a){a.mapboxMarker.addTo(L)}),l.animate&&setTimeout(function(){s.each(t.reverse(),function(a,o){a.elements.parent.className=(a.elements.parent.className||"").replace("initial",""),a.elements.parent.style.transitionDelay=l.animationSpeed/1e3/t.length*o+"s"})}),p=t},this.unspiderfy=S,this.each=function(e){s.each(p,e)}}});